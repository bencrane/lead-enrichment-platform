{
  "name": "Lead Magic - Job Region Loader",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "job-region-loader",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.leadmagic.io/v1/jobs/job-region",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {"name": "X-API-Key", "value": "35EXHsJ9YGfZXnmSMLZQ0N8iPtDOwPO5"}
          ]
        },
        "options": {}
      },
      "id": "api",
      "name": "API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "TRUNCATE TABLE job_regions; WITH inserts AS (SELECT jsonb_array_elements($1::jsonb) as region_item) INSERT INTO job_regions (region_id, region_name) SELECT (region_item->>'id')::int, region_item->>'name' FROM inserts;",
        "options": {}
      },
      "id": "insert",
      "name": "Insert",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [680, 300],
      "credentials": {"postgres": {"id": "supabase-db"}}
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true, \"loaded\": \"job_regions\"}",
        "options": {}
      },
      "id": "respond",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [900, 300]
    }
  ],
  "connections": {
    "Webhook": {"main": [[{"node": "API", "type": "main", "index": 0}]]},
    "API": {"main": [[{"node": "Insert", "type": "main", "index": 0}]]},
    "Insert": {"main": [[{"node": "Respond", "type": "main", "index": 0}]]}
  },
  "settings": {"executionOrder": "v1"},
  "tags": [{"name": "Lead Magic"}, {"name": "Reference Data"}],
  "triggerCount": 1
}
